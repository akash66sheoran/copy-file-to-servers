trigger:
- master

pool:
  vmImage: ubuntu-latest

steps:
- task: AzureKeyVault@2
  inputs:
    azureSubscription: 'Free Trial(3e90ec82-5e98-45e3-af9a-a1f6fb1938c0)'
    KeyVaultName: 'fdafsdfsdfd34533'
    SecretsFilter: '*'
    RunAsPreJob: false
- script: echo $(server-key) > /tmp/private_key.pem
- task: Ansible@0
  inputs:
    ansibleInterface: 'agentMachine'
    playbookPathOnAgentMachine: '$(Build.SourcesDirectory)/ansible/playbook.yml'
    inventoriesAgentMachine: 'file'
    inventoryFileOnAgentMachine: '$(Build.SourcesDirectory)/ansible/hosts'
    args: '--private-key=/tmp/private_key.pem'